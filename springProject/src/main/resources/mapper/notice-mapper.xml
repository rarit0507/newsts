<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="noticeMapper">
   
   <sql id="selectNotice">
      SELECT
               NOTICE_NO noticeNo,
               NOTICE_TITLE noticeTitle,
               NOTICE_CONTENT noticeContent,
               NOTICE_WRITER noticeWriter,
               CREATE_DATE createDate
   </sql>

   <select id="noticeCount" resultType="_int">   
      SELECT
               COUNT(NOTICE_NO)
        FROM
               NOTICE
   </select>
   
   <select id="findAll" resultType="notice" parameterType="map">
   
   <include refid="selectNotice"/>
       FROM
            (SELECT 
                    NOTICE_NO,
                    NOTICE_TITLE,
                    NOTICE_WRITER,
                    NOTICE_CONTENT,
                    CREATE_DATE,
                    ROWNUM RNUM 
              FROM
                       (SELECT 
                             NOTICE_NO,
                             NOTICE_TITLE,
                             NOTICE_WRITER,
                             NOTICE_CONTENT,
                             CREATE_DATE
                        FROM
                             NOTICE
                       ORDER
                          BY
                             NOTICE_NO DESC))               
WHERE
      RNUM BETWEEN #{startValue} AND #{endValue} 
   </select>
   
   <select id="searchCount" parameterType="map" resultType="int">
    SELECT 
          COUNT(NOTICE_NO)
      FROM    
            NOTICE
     WHERE 
    <choose>
        <when test="condition == 'writer'">
            NOTICE_WRITER LIKE '%' || #{keyword} || '%'
        </when>
        <when test="condition == 'title'">
            NOTICE_TITLE LIKE '%' || #{keyword} || '%'
        </when>
        <when test="condition == 'content'">
            NOTICE_CONTENT LIKE '%' || #{keyword} || '%'
        </when>
    </choose>
   </select>
   
   <!-- 검색 결과-->
   <select id="findByConditionAndKeyword" parameterType="map" resultType="notice">
    SELECT
           NOTICE_NO noticeNo,
           NOTICE_TITLE noticeTitle,
           NOTICE_CONTENT noticeContent,
           NOTICE_WRITER noticeWriter,
           CREATE_DATE createDate
      FROM
           NOTICE
     WHERE
    <choose>
        <when test="condition == 'writer'">
            NOTICE_WRITER LIKE '%' || #{keyword} || '%'
        </when>
        <when test="condition == 'title'">
            NOTICE_TITLE LIKE '%' || #{keyword} || '%'
        </when>
        <when test="condition == 'content'">
            NOTICE_CONTENT LIKE '%' || #{keyword} || '%'
        </when>
    </choose>
     ORDER
        BY 
           NOTICE_NO DESC
   </select>
   
   <insert id="insert" parameterType="notice">
      INSERT
         INTO
               NOTICE
               (
               NOTICE_NO,
               NOTICE_TITLE,
               NOTICE_CONTENT,
               NOTICE_WRITER,
               CREATE_DATE
               )
       VALUES
               (
               SEQ_NNO.NEXTVAL,
               #{noticeTitle},
               #{noticeContent},
               #{noticeWriter},
               SYSDATE
               )
   </insert>
</mapper>